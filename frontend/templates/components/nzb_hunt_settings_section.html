<!-- NZB Hunt Settings Section - Standalone module (independent of Movie Hunt / Requestarr) -->
<section id="nzb-hunt-settings-section" class="content-section" style="display: none;">
    <link rel="stylesheet" href="./static/css/nzb-hunt.css">
    <div class="nzb-hunt-container">

        <!-- Settings sub-nav tabs -->
        <div class="nzb-settings-tabs">
            <button class="nzb-settings-tab active" data-settings-tab="folders" id="nzb-settings-tab-folders">
                <i class="fas fa-folder-open"></i> Folders
            </button>
            <button class="nzb-settings-tab" data-settings-tab="servers" id="nzb-settings-tab-servers">
                <i class="fas fa-server"></i> Servers
            </button>
            <button class="nzb-settings-tab" data-settings-tab="processing" id="nzb-settings-tab-processing">
                <i class="fas fa-cogs"></i> Processing
            </button>
            <button class="nzb-settings-tab" data-settings-tab="advanced" id="nzb-settings-tab-advanced">
                <i class="fas fa-sliders-h"></i> Advanced
            </button>
        </div>

        <!-- ═══════ Folders Panel (temp folder + completed categories) ═══════ -->
        <div class="nzb-settings-panel" data-settings-panel="folders" style="display: block;">

            <!-- Temporary Folder -->
            <div class="nzb-settings-group" style="padding-bottom: 12px;">
                <h3 style="margin-bottom: 8px;"><i class="fas fa-folder-open" style="color: #f59e0b; margin-right: 8px;"></i>Temporary Folder</h3>
                <div class="nzb-folder-row" style="margin-top: 0;">
                    <div class="nzb-folder-label" style="min-width: 0; flex: 0 0 auto;">
                        <span class="nzb-folder-desc" style="margin: 0;">In-progress downloads are stored here until finished.</span>
                    </div>
                    <div class="nzb-folder-input-group">
                        <input type="text" id="nzb-temp-folder" class="nzb-folder-input" value="/downloads/incomplete" autocomplete="off" />
                        <button type="button" class="nzb-btn-browse" id="nzb-browse-temp-folder"><i class="fas fa-folder-open"></i> Browse</button>
                    </div>
                </div>
            </div>

            <!-- Completed Categories -->
            <div class="nzb-settings-group" style="margin-top: 20px; margin-bottom: 24px;">
                <h3><i class="fas fa-tags" style="color: #a78bfa; margin-right: 8px;"></i>Completed Categories</h3>
                <p class="nzb-settings-help">Each category defines a completed download folder. Downloads are moved here after post-processing.</p>

                <!-- Category cards -->
                <div class="nzb-cat-grid" id="nzb-cat-grid">
                    <!-- Category cards rendered dynamically -->
                    <div class="nzb-cat-add-card" id="nzb-add-cat-card">
                        <div class="add-icon"><i class="fas fa-plus-circle"></i></div>
                        <div class="add-text">Add Category</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ═══════ Servers Panel ═══════ -->
        <div class="nzb-settings-panel" data-settings-panel="servers" style="display: none;">
            <div class="nzb-settings-group">
                <h3><i class="fas fa-server" style="color: #3b82f6; margin-right: 8px;"></i>Usenet Servers</h3>
                <p class="nzb-settings-help">Add your Usenet provider connections. Servers are tried in priority order (lower number = higher priority).</p>
                <div class="instance-card-grid" id="nzb-server-grid">
                    <!-- Server cards rendered dynamically -->
                    <div class="add-instance-card" id="nzb-add-server-card">
                        <div class="add-icon"><i class="fas fa-plus-circle"></i></div>
                        <div class="add-text">Add Server</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ═══════ Processing Panel ═══════ -->
        <div class="nzb-settings-panel" data-settings-panel="processing" style="display: none;">
            <div class="nzb-settings-group">
                <h3><i class="fas fa-cogs" style="color: #10b981; margin-right: 8px;"></i>Processing</h3>
                <p class="nzb-settings-help">Configure how NZB Hunt handles downloads, retries, and post-processing.</p>

                <!-- Retries -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Maximum retries</span>
                        <span class="nzb-folder-desc">Maximum number of retry attempts per article per server.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 120px;">
                        <input type="number" id="nzb-proc-max-retries" class="nzb-folder-input" value="3" min="0" max="10" style="text-align: center;" />
                    </div>
                </div>

                <!-- Abort hopeless jobs -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Abort jobs that cannot be completed</span>
                        <span class="nzb-folder-desc">When during download it becomes clear that too much data is missing, abort the job.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 80px;">
                        <label class="nzb-toggle-row" style="margin:0;">
                            <input type="checkbox" id="nzb-proc-abort-hopeless" checked />
                            <span class="nzb-toggle-switch"></span>
                        </label>
                    </div>
                </div>

                <!-- Abort threshold -->
                <div class="nzb-folder-row" id="nzb-proc-abort-threshold-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Abort threshold (%)</span>
                        <span class="nzb-folder-desc">Abort download when this percentage of articles is missing.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 120px;">
                        <input type="number" id="nzb-proc-abort-threshold" class="nzb-folder-input" value="5" min="1" max="50" step="1" style="text-align: center;" />
                    </div>
                </div>

                <!-- Propagation delay -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Propagation delay</span>
                        <span class="nzb-folder-desc">Posts will be paused until they are at least this age (minutes). Setting job priority to Force will skip the delay.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 160px;">
                        <input type="number" id="nzb-proc-propagation-delay" class="nzb-folder-input" value="0" min="0" max="1440" style="text-align: center;" />
                        <span style="color: #94a3b8; font-size: 0.85em; margin-left: 8px;">mins</span>
                    </div>
                </div>

                <!-- Disconnect on empty queue -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Disconnect on empty queue</span>
                        <span class="nzb-folder-desc">Disconnect from Usenet server(s) when queue is empty or paused.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 80px;">
                        <label class="nzb-toggle-row" style="margin:0;">
                            <input type="checkbox" id="nzb-proc-disconnect-empty" checked />
                            <span class="nzb-toggle-switch"></span>
                        </label>
                    </div>
                </div>

                <hr style="border-color: rgba(148,163,184,0.15); margin: 24px 0;">

                <!-- Post-processing section -->
                <h3 style="margin-top: 0;"><i class="fas fa-magic" style="color: #8b5cf6; margin-right: 8px;"></i>Post-Processing</h3>

                <!-- Direct unpack -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Direct Unpack</span>
                        <span class="nzb-folder-desc">Jobs will start unpacking during downloading. Only works for jobs that do not need repair.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 80px;">
                        <label class="nzb-toggle-row" style="margin:0;">
                            <input type="checkbox" id="nzb-proc-direct-unpack" />
                            <span class="nzb-toggle-switch"></span>
                        </label>
                    </div>
                </div>

                <!-- Action on encrypted RAR -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Action when encrypted RAR is downloaded</span>
                        <span class="nzb-folder-desc">In case of &ldquo;Pause&rdquo;, you'll need to set a password and resume the job.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 180px;">
                        <select id="nzb-proc-encrypted-rar" class="nzb-form-select">
                            <option value="pause">Pause</option>
                            <option value="abort">Abort</option>
                            <option value="ignore">Continue</option>
                        </select>
                    </div>
                </div>

                <!-- Unwanted extensions -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Unwanted extensions</span>
                        <span class="nzb-folder-desc">Comma-separated list of unwanted file extensions. For example: <code>exe, com, bat</code></span>
                    </div>
                    <div class="nzb-folder-input-group" style="flex: 1; max-width: 400px;">
                        <select id="nzb-proc-unwanted-action" class="nzb-form-select" style="max-width: 130px;">
                            <option value="off" selected>Off</option>
                            <option value="blacklist">Blacklist</option>
                            <option value="abort">Abort</option>
                        </select>
                        <input type="text" id="nzb-proc-unwanted-ext" class="nzb-folder-input" value="exe" placeholder="exe, com, bat" autocomplete="off" style="flex: 1;" />
                    </div>
                </div>

                <div class="nzb-settings-footer">
                    <button class="nzb-btn nzb-btn-primary" id="nzb-save-processing"><i class="fas fa-save"></i> Save Processing</button>
                </div>
            </div>
        </div>

        <!-- ═══════ Advanced Panel ═══════ -->
        <div class="nzb-settings-panel" data-settings-panel="advanced" style="display: none;">
            <div class="nzb-settings-group">
                <h3><i class="fas fa-sliders-h" style="color: #f59e0b; margin-right: 8px;"></i>Performance Tuning</h3>
                <p class="nzb-settings-help">Fine-tune download performance, CPU usage, and resource limits. These settings help balance speed against system load.</p>

                <!-- Receive Threads -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Receive Threads</span>
                        <span class="nzb-folder-desc">Number of threads used to read and decode download data. Lower values reduce CPU usage; higher values may improve download speed on fast connections.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 120px;">
                        <input type="number" id="nzb-adv-receive-threads" class="nzb-folder-input" value="2" min="1" max="8" style="text-align: center;" />
                    </div>
                </div>

                <!-- Downloader Sleep Time -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">CPU Throttle</span>
                        <span class="nzb-folder-desc">A small delay added between data reads to reduce CPU load. Higher values use less CPU but may reduce download speed. Value of 10 = 1ms. Set to 0 only if max connections don't reach full speed.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 120px;">
                        <input type="number" id="nzb-adv-sleep-time" class="nzb-folder-input" value="10" min="0" max="100" style="text-align: center;" />
                    </div>
                </div>

                <!-- Direct Unpack Threads -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Concurrent Unpack Limit</span>
                        <span class="nzb-folder-desc">Maximum number of simultaneous unpack operations. Limits disk I/O strain when multiple downloads finish at once. Increase on fast storage (SSD/NVMe), decrease on slower drives.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 120px;">
                        <input type="number" id="nzb-adv-unpack-threads" class="nzb-folder-input" value="3" min="1" max="10" style="text-align: center;" />
                    </div>
                </div>

                <hr style="border-color: rgba(148,163,184,0.15); margin: 24px 0;">

                <h3 style="margin-top: 0;"><i class="fas fa-shield-alt" style="color: #3b82f6; margin-right: 8px;"></i>Download Protection</h3>
                <p class="nzb-settings-help">Control how downloads are filtered and validated to prevent wasting bandwidth on bad or oversized NZBs.</p>

                <!-- Size Limit -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Download Size Limit</span>
                        <span class="nzb-folder-desc">Downloads exceeding this size are automatically paused with low priority. Useful for preventing unexpectedly large grabs. Set to 0 for no limit.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 180px;">
                        <input type="text" id="nzb-adv-size-limit" class="nzb-folder-input" value="" placeholder="e.g. 25G" autocomplete="off" />
                        <span style="color: #64748b; font-size: 0.8em; margin-left: 8px; white-space: nowrap;">K / M / G</span>
                    </div>
                </div>

                <!-- Completion Rate -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">Minimum Completion Rate (%)</span>
                        <span class="nzb-folder-desc">Downloads with availability below this percentage are aborted early via pre-check. A perfect download with 10% par2 files is 110%. Anything below 100% is unrepairable by definition.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 120px;">
                        <input type="number" id="nzb-adv-completion-rate" class="nzb-folder-input" value="100.2" min="90" max="120" step="0.1" style="text-align: center;" />
                    </div>
                </div>

                <!-- Max URL Retries -->
                <div class="nzb-folder-row">
                    <div class="nzb-folder-label">
                        <span class="nzb-folder-title">NZB Fetch Retries</span>
                        <span class="nzb-folder-desc">How many times to retry when fetching an NZB from an indexer fails. Each retry waits progressively longer (60s, 120s, 180s&hellip;). Only applies to temporary server errors.</span>
                    </div>
                    <div class="nzb-folder-input-group" style="max-width: 120px;">
                        <input type="number" id="nzb-adv-url-retries" class="nzb-folder-input" value="10" min="0" max="50" style="text-align: center;" />
                    </div>
                </div>

                <div class="nzb-settings-footer">
                    <button class="nzb-btn nzb-btn-primary" id="nzb-save-advanced"><i class="fas fa-save"></i> Save Advanced</button>
                </div>
            </div>
        </div>

    </div>

    <!-- ═══════ Add/Edit Category Modal ═══════ -->
    <div id="nzb-cat-modal" class="nzb-server-modal" style="display: none;">
        <div class="nzb-server-modal-backdrop" id="nzb-cat-modal-backdrop"></div>
        <div class="nzb-server-modal-content">
            <div class="nzb-server-modal-header" style="background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e293b 100%);">
                <button type="button" class="nzb-server-modal-close" id="nzb-cat-modal-close" aria-label="Close"><i class="fas fa-times"></i></button>
                <div class="nzb-server-modal-header-overlay">
                    <h2 id="nzb-cat-modal-title">Add Category</h2>
                    <p class="nzb-server-modal-subtitle">Configure a download category with its own folder and rules.</p>
                </div>
            </div>
            <div class="nzb-server-modal-body">
                <div class="nzb-form-group">
                    <label for="nzb-cat-name">Category Name</label>
                    <input type="text" id="nzb-cat-name" placeholder="e.g. movies, tv, music" autocomplete="off" />
                    <span class="nzb-form-hint">Used as the subfolder name under the completed folder.</span>
                </div>
                <div class="nzb-form-group">
                    <label for="nzb-cat-folder">Folder Path</label>
                    <div class="nzb-folder-input-group">
                        <input type="text" id="nzb-cat-folder" class="nzb-folder-input" placeholder="Auto-generated from name" autocomplete="off" readonly />
                        <button type="button" class="nzb-btn-browse" id="nzb-cat-browse-folder"><i class="fas fa-folder-open"></i> Browse</button>
                    </div>
                    <span class="nzb-form-hint">Auto-filled from category name. Override with Browse if needed.</span>
                </div>
                <div class="nzb-form-row">
                    <div class="nzb-form-group" style="flex: 1;">
                        <label for="nzb-cat-priority">Priority</label>
                        <select id="nzb-cat-priority" class="nzb-form-select">
                            <option value="default">Default</option>
                            <option value="force">Force</option>
                            <option value="high">High</option>
                            <option value="normal" selected>Normal</option>
                            <option value="low">Low</option>
                            <option value="paused">Paused</option>
                        </select>
                    </div>
                    <div class="nzb-form-group" style="flex: 1;">
                        <label for="nzb-cat-processing">Processing</label>
                        <select id="nzb-cat-processing" class="nzb-form-select">
                            <option value="default" selected>Default</option>
                            <option value="+repair">+Repair</option>
                            <option value="+unpack">+Unpack</option>
                            <option value="+delete">+Delete</option>
                        </select>
                    </div>
                </div>
                <div class="nzb-form-group">
                    <label for="nzb-cat-indexer">Indexer Categories / Groups</label>
                    <input type="text" id="nzb-cat-indexer" placeholder="e.g. movies, movies.hd, movies.uhd" autocomplete="off" />
                    <span class="nzb-form-hint">Comma-separated list of Newznab categories or group patterns the indexer sends.</span>
                </div>
            </div>
            <div class="nzb-server-modal-footer">
                <button type="button" class="nzb-btn" id="nzb-cat-modal-cancel">Cancel</button>
                <button type="button" class="nzb-btn nzb-btn-primary" id="nzb-cat-modal-save"><i class="fas fa-save"></i> Save</button>
            </div>
        </div>
    </div>

    <!-- ═══════ Add/Edit Server Modal ═══════ -->
    <div id="nzb-server-modal" class="nzb-server-modal" style="display: none;">
        <div class="nzb-server-modal-backdrop" id="nzb-server-modal-backdrop"></div>
        <div class="nzb-server-modal-content">
            <div class="nzb-server-modal-header">
                <button type="button" class="nzb-server-modal-close" id="nzb-server-modal-close" aria-label="Close"><i class="fas fa-times"></i></button>
                <div class="nzb-server-modal-header-overlay">
                    <h2 id="nzb-server-modal-title">Add Usenet Server</h2>
                </div>
            </div>
            <div class="nzb-server-modal-body">
                <div class="nzb-form-group">
                    <label for="nzb-server-name">Name</label>
                    <input type="text" id="nzb-server-name" placeholder="e.g. EasyNews" autocomplete="off" />
                </div>
                <div class="nzb-form-row">
                    <div class="nzb-form-group" style="flex: 2;">
                        <label for="nzb-server-host">Host</label>
                        <input type="text" id="nzb-server-host" placeholder="news.provider.com" autocomplete="off" />
                    </div>
                    <div class="nzb-form-group" style="flex: 1;">
                        <label for="nzb-server-port">Port</label>
                        <input type="number" id="nzb-server-port" value="563" min="1" max="65535" />
                    </div>
                </div>
                <div class="nzb-form-group">
                    <label class="nzb-toggle-row">
                        <span>SSL / TLS</span>
                        <input type="checkbox" id="nzb-server-ssl" checked />
                        <span class="nzb-toggle-switch"></span>
                    </label>
                </div>
                <div class="nzb-form-row">
                    <div class="nzb-form-group" style="flex: 1;">
                        <label for="nzb-server-username">Username</label>
                        <input type="text" id="nzb-server-username" placeholder="" autocomplete="off" />
                    </div>
                    <div class="nzb-form-group" style="flex: 1;">
                        <label for="nzb-server-password">Password</label>
                        <input type="password" id="nzb-server-password" placeholder="" autocomplete="off" />
                    </div>
                </div>
                <div class="nzb-form-row">
                    <div class="nzb-form-group" style="flex: 1;">
                        <label for="nzb-server-connections">Connections</label>
                        <input type="number" id="nzb-server-connections" value="8" min="1" max="100" />
                    </div>
                    <div class="nzb-form-group" style="flex: 1;">
                        <label for="nzb-server-priority">Priority</label>
                        <input type="number" id="nzb-server-priority" value="0" min="0" max="99" />
                        <span class="nzb-form-hint">0 = highest</span>
                    </div>
                </div>
                <div class="nzb-form-group">
                    <label class="nzb-toggle-row">
                        <span>Enabled</span>
                        <input type="checkbox" id="nzb-server-enabled" checked />
                        <span class="nzb-toggle-switch"></span>
                    </label>
                </div>

                <!-- Connection Test Status -->
                <div id="nzb-server-test-status" class="nzb-server-test-status" style="display: none;">
                    <div class="nzb-server-test-inner">
                        <i id="nzb-server-test-icon" class="fas fa-circle-notch fa-spin"></i>
                        <span id="nzb-server-test-msg">Testing connection...</span>
                    </div>
                </div>
            </div>
            <div class="nzb-server-modal-footer">
                <button type="button" class="nzb-btn" id="nzb-server-modal-cancel">Cancel</button>
                <button type="button" class="nzb-btn nzb-btn-test" id="nzb-server-modal-test"><i class="fas fa-plug"></i> Test Connection</button>
                <button type="button" class="nzb-btn nzb-btn-primary" id="nzb-server-modal-save" disabled title="Test connection first (click Test Connection)"><i class="fas fa-save"></i> Save</button>
            </div>
        </div>
    </div>

    <!-- ═══════ File Browser Modal (standalone for NZB Hunt) ═══════ -->
    <div id="nzb-browse-modal" class="nzb-browse-modal" style="display: none;">
        <div class="nzb-browse-backdrop" id="nzb-browse-backdrop"></div>
        <div class="nzb-browse-content">
            <div class="nzb-browse-header">
                <h2>File Browser</h2>
                <button type="button" class="nzb-browse-close" id="nzb-browse-close" aria-label="Close"><i class="fas fa-times"></i></button>
            </div>
            <div class="nzb-browse-body">
                <label>Start typing or select a path below</label>
                <input type="text" id="nzb-browse-path-input" placeholder="/" autocomplete="off" />
                <div class="nzb-browse-up-row">
                    <button type="button" class="nzb-browse-up-btn" id="nzb-browse-up"><i class="fas fa-arrow-up"></i> Go Back</button>
                </div>
                <div id="nzb-browse-list" class="nzb-browse-list"></div>
            </div>
            <div class="nzb-browse-actions">
                <button type="button" class="nzb-btn" id="nzb-browse-cancel">Cancel</button>
                <button type="button" class="nzb-btn nzb-btn-primary" id="nzb-browse-ok"><i class="fas fa-save"></i> Save</button>
            </div>
        </div>
    </div>
</section>
