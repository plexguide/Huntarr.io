<!-- Mobile Navigation â€” Topbar + Slide-out Drawer -->

<!-- ===== MOBILE TOPBAR ===== -->
<div id="mobile-topbar" class="mtb">
    <div class="mtb-inner">
        <!-- Left: Logo + Hamburger -->
        <div class="mtb-left">
            <button class="mtb-hamburger" id="mobileMenuToggle" aria-label="Open menu">
                <span></span><span></span><span></span>
            </button>
            <a href="#home" class="mtb-logo-link">
                <img src="./static/logo/32.png" alt="Huntarr" class="mtb-logo" width="28" height="28">
            </a>
            <span class="mtb-title" id="mobilePageTitle">Home</span>
        </div>

        <!-- Right: Heart donate -->
        <div class="mtb-right">
            <a href="https://plexguide.github.io/Huntarr.io/donate.html" target="_blank" rel="noopener noreferrer"
               class="mtb-icon-btn mtb-heart" title="Become a Sponsor" aria-label="Donate">
                <i class="fas fa-heart"></i>
            </a>
        </div>
    </div>
    <!-- Accent line -->
    <div class="mtb-accent"></div>
</div>

<!-- ===== MOBILE DRAWER (slide-out) ===== -->
<div class="mdrawer-backdrop" id="mobileDrawerBackdrop"></div>
<nav class="mdrawer" id="mobileDrawer" aria-label="Mobile navigation">
    <!-- Drawer header -->
    <div class="mdrawer-header">
        <img src="./static/logo/32.png" alt="Huntarr" class="mdrawer-logo" width="28" height="28">
        <span class="mdrawer-brand">Huntarr</span>
        <button class="mdrawer-close" id="mobileMenuClose" aria-label="Close menu">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Drawer nav items (mirroring main sidebar structure) -->
    <div class="mdrawer-body" id="mobileDrawerBody">
        <div class="mdrawer-group">
            <div class="mdrawer-group-title">Core</div>
            <a href="#home" class="mdrawer-item" data-section="home">
                <i class="fas fa-home"></i><span>Home</span>
            </a>
            <a href="#requestarr" class="mdrawer-item" data-section="requestarr">
                <i class="fas fa-plus-circle"></i><span>Requests</span>
            </a>
            <a href="#apps" class="mdrawer-item" data-section="apps">
                <i class="fas fa-th-large"></i><span>Apps</span>
            </a>
        </div>

        <div class="mdrawer-group">
            <div class="mdrawer-group-title">System</div>
            <a href="#hunt-manager" class="mdrawer-item" data-section="hunt-manager">
                <i class="fas fa-crosshairs"></i><span>Hunt Manager</span>
            </a>
            <a href="#logs" class="mdrawer-item" data-section="logs">
                <i class="fas fa-list-alt"></i><span>Logs</span>
            </a>
            <a href="#about" class="mdrawer-item" data-section="about">
                <i class="fas fa-info-circle"></i><span>About</span>
            </a>
        </div>

        <div class="mdrawer-group">
            <div class="mdrawer-group-title">Settings</div>
            <a href="#settings" class="mdrawer-item" data-section="settings">
                <i class="fas fa-sliders-h"></i><span>Main</span>
            </a>
            <a href="#scheduling" class="mdrawer-item" data-section="scheduling">
                <i class="fas fa-calendar-alt"></i><span>Scheduling</span>
            </a>
            <a href="#notifications" class="mdrawer-item" data-section="notifications">
                <i class="fas fa-bell"></i><span>Notifications</span>
            </a>
            <a href="#backup-restore" class="mdrawer-item" data-section="backup-restore">
                <i class="fas fa-database"></i><span>Backup / Restore</span>
            </a>
            <a href="#settings-logs" class="mdrawer-item" data-section="settings-logs">
                <i class="fas fa-file-alt"></i><span>Log Settings</span>
            </a>
            <a href="#user" class="mdrawer-item" data-section="user">
                <i class="fas fa-user"></i><span>User Account</span>
            </a>
        </div>

        <div class="mdrawer-group">
            <div class="mdrawer-group-title">Beta</div>
            <a href="#movie-hunt-collection" class="mdrawer-item" data-section="movie-hunt-collection">
                <i class="fas fa-folder-open"></i><span>Movie Hunt</span>
            </a>
            <a href="#nzb-hunt-home" class="mdrawer-item" data-section="nzb-hunt-home">
                <i class="fas fa-download"></i><span>NZB Hunt</span>
            </a>
        </div>

        <div class="mdrawer-group">
            <div class="mdrawer-group-title">Movie Hunt</div>
            <a href="#movie-hunt-collection" class="mdrawer-item" data-section="movie-hunt-collection">
                <i class="fas fa-film"></i><span>Media Collection</span>
            </a>
            <a href="#movie-hunt-calendar" class="mdrawer-item" data-section="movie-hunt-calendar">
                <i class="fas fa-calendar"></i><span>Calendar</span>
            </a>
            <a href="#activity-queue" class="mdrawer-item" data-section="activity-queue">
                <i class="fas fa-tasks"></i><span>Activity</span>
            </a>
            <a href="#movie-hunt-settings" class="mdrawer-item" data-section="movie-hunt-settings">
                <i class="fas fa-cog"></i><span>MH Settings</span>
            </a>
        </div>

        <!-- Donate link at bottom -->
        <div class="mdrawer-footer">
            <a href="https://plexguide.github.io/Huntarr.io/donate.html" target="_blank" rel="noopener noreferrer" class="mdrawer-donate">
                <i class="fas fa-heart"></i><span>Become a Sponsor</span>
            </a>
            <div class="mdrawer-version" id="mobileDrawerVersion"></div>
        </div>
    </div>
</nav>

<script>
(function() {
    function initMobileNav() {
        var toggle   = document.getElementById('mobileMenuToggle');
        var close    = document.getElementById('mobileMenuClose');
        var drawer   = document.getElementById('mobileDrawer');
        var backdrop = document.getElementById('mobileDrawerBackdrop');
        if (!toggle || !drawer) return;

        function open()  {
            drawer.classList.add('open');
            backdrop.classList.add('open');
            document.body.classList.add('mdrawer-open');
        }
        function shut()  {
            drawer.classList.remove('open');
            backdrop.classList.remove('open');
            document.body.classList.remove('mdrawer-open');
        }

        toggle.addEventListener('click', open);
        close.addEventListener('click', shut);
        backdrop.addEventListener('click', shut);

        // Close drawer when a nav item is tapped
        drawer.querySelectorAll('.mdrawer-item').forEach(function(item) {
            item.addEventListener('click', function() {
                shut();
            });
        });

        // Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && drawer.classList.contains('open')) shut();
        });

        // Update version info in drawer
        function updateDrawerVersion() {
            var el = document.getElementById('mobileDrawerVersion');
            if (!el) return;
            try {
                var info = JSON.parse(localStorage.getItem('huntarr-version-info') || '{}');
                if (info.currentVersion) el.textContent = 'v' + info.currentVersion;
            } catch(e) {}
        }
        updateDrawerVersion();
        window.addEventListener('storage', function(e) {
            if (e.key === 'huntarr-version-info') updateDrawerVersion();
        });
    }

    // Update mobile topbar with current section title
    function updateMobilePageTitle(title) {
        var el = document.getElementById('mobilePageTitle');
        if (el) el.textContent = title || 'Home';
    }
    window.updateMobilePageTitle = updateMobilePageTitle;

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            initMobileNav();
            // Sync page title
            var pt = document.getElementById('currentPageTitle');
            if (pt) updateMobilePageTitle(pt.textContent);
            var obs = new MutationObserver(function() {
                var pt2 = document.getElementById('currentPageTitle');
                if (pt2) updateMobilePageTitle(pt2.textContent);
            });
            if (pt) obs.observe(pt, { childList: true, characterData: true, subtree: true });
        });
    } else {
        initMobileNav();
    }
})();
</script>
