<section id="settingsCustomFormatsSection" class="content-section" style="display: none;">
    <div id="customFormatsManagementContainer" class="app-content-panel">
        <div class="settings-group custom-formats-settings-group">
            <h3>Custom Formats</h3>
            <p class="custom-formats-help">Radarr-style custom format JSONs from TRaSH Guides. Add Custom Format â†’ choose Pre-Formatted, pick categories and check the formats you want, then Add. Already-added formats stay checked (disabled). Or use Import to paste your own JSON.</p>
            <div class="instance-card-grid" id="custom-formats-grid">
                <div class="add-instance-card" id="custom-formats-add-card" data-app-type="custom-format">
                    <div class="add-icon"><i class="fas fa-plus-circle"></i></div>
                    <div class="add-text">Add Custom Format</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Custom Format modal -->
    <div id="custom-format-modal" class="custom-format-modal" style="display: none;">
        <div class="custom-format-modal-backdrop" id="custom-format-modal-backdrop"></div>
        <div class="custom-format-modal-content">
            <div class="custom-format-modal-header">
                <button type="button" class="custom-format-modal-close" id="custom-format-modal-close" aria-label="Close"><i class="fas fa-times"></i></button>
                <h2 class="custom-format-modal-title" id="custom-format-modal-title">Add Custom Format</h2>
                <p class="custom-format-modal-subtitle">Pre-Formatted: pick TRaSH Guides formats by category. Import: paste your own JSON.</p>
            </div>
            <div class="custom-format-modal-body">
                <div class="custom-format-source-row">
                    <label class="custom-format-source-option">
                        <input type="radio" name="custom-format-source" value="preformat" id="custom-format-source-preformat" checked>
                        <span>Pre-Formatted</span>
                    </label>
                    <label class="custom-format-source-option">
                        <input type="radio" name="custom-format-source" value="import" id="custom-format-source-import">
                        <span>Import</span>
                    </label>
                </div>
                <div id="custom-format-preformat-area" class="custom-format-area">
                    <p class="custom-format-preformat-hint">Select categories below, then check the formats you want to add. Already-added formats are checked and disabled.</p>
                    <div id="custom-format-preformat-tree" class="custom-format-preformat-tree"></div>
                </div>
                <div class="custom-format-field-row">
                    <label for="custom-format-title-input">Title</label>
                    <input type="text" id="custom-format-title-input" class="custom-format-title-input" placeholder="Display title" maxlength="128" autocomplete="off">
                </div>
                <div class="custom-format-area custom-format-json-row">
                    <label for="custom-format-json-textarea">Custom Format JSON</label>
                    <textarea id="custom-format-json-textarea" class="custom-format-json-textarea" placeholder='{"name": "My Format", ...}' rows="8"></textarea>
                </div>
            </div>
            <div class="custom-format-modal-actions">
                <button type="button" class="btn-card custom-format-modal-cancel" id="custom-format-modal-cancel">Cancel</button>
                <button type="button" class="btn-card custom-format-modal-save" id="custom-format-modal-save"><i class="fas fa-plus"></i> Add</button>
            </div>
        </div>
    </div>
</section>

<style>
    #settingsCustomFormatsSection { width: 100%; min-height: 100vh; overflow-y: auto; overflow-x: hidden; padding: 0; margin: 0; }
    #settingsCustomFormatsSection.active { display: block !important; }
    #customFormatsManagementContainer { width: 100%; padding: 20px; margin: 0; background: transparent; box-shadow: none; border: none; }
    .custom-formats-settings-group {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        border: 2px solid rgba(90, 109, 137, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin: 15px 0 25px 0;
        box-shadow: 0 4px 12px rgba(90, 109, 137, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    .custom-formats-settings-group h3 { margin: 0 0 8px 0; font-size: 1.2rem; font-weight: 600; color: #f8fafc; }
    .custom-formats-help { margin: 0 0 20px 0; color: #94a3b8; font-size: 0.95rem; }
    #custom-formats-grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 14px; margin-bottom: 20px; }
    #custom-formats-grid .custom-format-card {
        padding: 12px 14px; border-radius: 10px; display: flex; flex-direction: column; height: 100%; min-height: 100px;
        background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
        border: 1px solid rgba(148, 163, 184, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    #custom-formats-grid .custom-format-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.2); border-color: rgba(99,102,241,0.3); }
    #custom-formats-grid .custom-format-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    #custom-formats-grid .custom-format-card-title { font-size: 0.95rem; font-weight: 600; color: #f8fafc; display: flex; align-items: center; gap: 8px; word-break: break-all; }
    #custom-formats-grid .custom-format-card-body { flex: 1; min-height: 0; color: #94a3b8; font-size: 0.85rem; }
    #custom-formats-grid .custom-format-card-footer { display: flex; gap: 6px; margin-top: 0; }
    #custom-formats-grid .custom-format-card .btn-card { padding: 6px 10px; font-size: 0.8rem; }
    #custom-formats-grid .add-instance-card { min-height: 100px; }
    .custom-format-modal { position: fixed; top:0;left:0;right:0;bottom:0; z-index: 1000; display: none; align-items: center; justify-content: center; }
    .custom-format-modal[style*="display: flex"] { display: flex !important; }
    body.custom-format-modal-open { overflow: hidden; }
    .custom-format-modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; }
    .custom-format-modal-content { position: relative; z-index: 1001; background: rgba(15,23,42,0.98); border: 2px solid rgba(99,102,241,0.4); border-radius: 12px; max-width: 560px; width: 90%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
    .custom-format-modal-header { position: relative; padding: 20px 24px 12px; background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #0f172a 100%); }
    .custom-format-modal-close { position: absolute; top: 12px; right: 12px; background: transparent; border: none; color: #94a3b8; font-size: 1.2rem; cursor: pointer; padding: 4px; }
    .custom-format-modal-close:hover { color: #f8fafc; }
    .custom-format-modal-title { margin: 0 0 4px 0; font-size: 1.25rem; font-weight: 600; color: #f8fafc; }
    .custom-format-modal-subtitle { margin: 0; font-size: 0.9rem; color: #94a3b8; }
    .custom-format-modal-body { padding: 20px 24px; overflow-y: auto; flex: 1; }
    .custom-format-source-row { display: flex; gap: 20px; margin-bottom: 16px; }
    .custom-format-source-option { display: flex; align-items: center; gap: 8px; color: #cbd5e1; cursor: pointer; }
    .custom-format-area { margin-bottom: 16px; }
    .custom-format-area label { display: block; margin-bottom: 6px; font-size: 0.9rem; color: #cbd5e1; }
    .custom-format-select { width: 100%; padding: 10px 12px; font-size: 1rem; color: #f8fafc; background: rgba(15,23,42,0.8); border: 1px solid rgba(148,163,184,0.3); border-radius: 8px; box-sizing: border-box; }
    .custom-format-json-textarea { width: 100%; padding: 10px 12px; font-size: 0.85rem; font-family: monospace; color: #f8fafc; background: rgba(15,23,42,0.8); border: 1px solid rgba(148,163,184,0.3); border-radius: 8px; resize: vertical; min-height: 120px; box-sizing: border-box; }
    .custom-format-field-row { margin-bottom: 12px; }
    .custom-format-field-row label { display: block; margin-bottom: 6px; font-size: 0.9rem; color: #cbd5e1; }
    .custom-format-title-input { width: 100%; padding: 10px 12px; font-size: 1rem; color: #f8fafc; background: rgba(15,23,42,0.8); border: 1px solid rgba(148,163,184,0.3); border-radius: 8px; box-sizing: border-box; }
    .custom-format-modal-actions { display: flex; justify-content: flex-end; gap: 12px; padding: 16px 24px 20px; border-top: 1px solid rgba(148,163,184,0.1); }
    .custom-format-preformat-hint { margin: 0 0 12px 0; font-size: 0.85rem; color: #94a3b8; }
    .custom-format-preformat-tree { max-height: 320px; overflow-y: auto; border: 1px solid rgba(148,163,184,0.2); border-radius: 8px; padding: 10px; background: rgba(15,23,42,0.6); margin-bottom: 12px; }
    .custom-format-cat { margin-bottom: 8px; }
    .custom-format-cat-header { display: flex; align-items: center; gap: 8px; padding: 8px 10px; cursor: pointer; border-radius: 6px; background: rgba(30,41,59,0.6); color: #e2e8f0; font-weight: 600; font-size: 0.95rem; user-select: none; }
    .custom-format-cat-header:hover { background: rgba(51,65,85,0.8); }
    .custom-format-cat-header i.fa-chevron-down { transition: transform 0.2s ease; }
    .custom-format-cat-header.collapsed i.fa-chevron-down { transform: rotate(-90deg); }
    .custom-format-cat-body { padding: 8px 10px 8px 24px; }
    .custom-format-cat-body.collapsed { display: none; }
    .custom-format-subcat { margin-bottom: 6px; }
    .custom-format-subcat-name { font-size: 0.85rem; color: #94a3b8; margin-bottom: 4px; padding-left: 4px; }
    .custom-format-format-list { display: flex; flex-wrap: wrap; gap: 8px 16px; }
    .custom-format-format-item { display: flex; align-items: center; gap: 6px; font-size: 0.9rem; color: #cbd5e1; cursor: pointer; }
    .custom-format-format-item input[type="checkbox"] { cursor: pointer; }
    .custom-format-format-item input[type="checkbox"]:disabled + span { color: #64748b; }
    .custom-format-loading { color: #94a3b8; font-size: 0.9rem; }
</style>
