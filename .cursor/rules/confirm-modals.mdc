---
description: Use custom modals for confirmations/additions; use toasts instead of alert(). No native confirm/alert/prompt for user-facing flows.
globs: ["**/*.js", "**/*.html"]
alwaysApply: true
---
# Confirm Modals & Notifications Rule (No Old-School Popups)

## Two Patterns: Modals vs Toasts

| User interaction | Old (avoid) | New (use) |
|------------------|-------------|-----------|
| **User must choose** (OK/Cancel, Delete/Confirm, or enter a value) | `confirm()`, `prompt()` | **Custom modal** (HuntarrConfirm or section-specific add/rename modal) |
| **One-way message** (error, success, info — no choice) | `alert()` | **Toast notification** via `window.huntarrUI.showNotification(msg, type)` with `alert()` fallback |

- **Modals** = user must click something (Cancel, Delete, Save, etc.). These are **not** toasts.
- **Toasts** = auto-dismissing notifications. Use for success/error/info that replaced `alert()`.

---

## 1. When the User Must Choose: Use Modals

### Global Confirm Modal (Deletions / Destructive Actions)

- Use **`window.HuntarrConfirm.show()`** for:
  - Delete confirmations (instances, profiles, indexers, clients, root folders, custom formats, schedules, app instances, backups, etc.)
  - Clear/reset actions (logs, history, hunt history, blocklist remove, state reset, stats reset, Swaparr reset, etc.)
  - Other destructive or irreversible actions (restore/upload backup, unlink Plex, hide/unhide media, etc.)

**API:**
```javascript
window.HuntarrConfirm.show({
    title: 'Delete Something',      // Modal heading
    message: 'Are you sure...?',    // Body text (supports \n for newlines)
    confirmLabel: 'Delete',        // Button text (e.g. Delete, Clear, Reset, OK)
    onConfirm: function() {         // Called when user clicks confirm
        // Perform the action (e.g. fetch DELETE, then refresh)
    }
});
```

- **Fallback:** If `HuntarrConfirm` is not available, fall back to `confirm()` so behavior still works.
- **Styling:** Purple/blue theme, blur backdrop. CSS: `frontend/static/css/confirm-modal.css`. HTML: `frontend/templates/components/confirm_modal.html`.

### Add / Edit Flows (Custom Modals, Not prompt())

- Use **custom modal popups** (backdrop, blur, purple/blue) for:
  - Adding items (Add Instance, Add Profile, Add Remote Path Mapping, Add Client, Add Indexer).
  - Editing/renaming (e.g. Rename Instance) — use a modal with an input, not `prompt()`.
- **DO NOT** use `window.prompt()` or `window.confirm()` for these flows.
- **Pattern:** Modal in section template or shared component, move to `document.body` when opening, body class for blur, same purple/blue styles as Add Instance / Remote Mapping.

---

## 2. When It’s Just a Message: Use Toasts (Not alert)

- For **success, error, or info** messages that do **not** require the user to click OK, use the **toast** system so the message auto-dismisses.
- **DO NOT** use `alert()` when the app notification system is available.

**Pattern (always prefer toast, fallback to alert):**
```javascript
if (window.huntarrUI && window.huntarrUI.showNotification) {
    window.huntarrUI.showNotification(message, 'error');   // or 'success' / 'info'
} else {
    alert(message);
}
```

- Use `'error'` for validation/API failures, `'success'` for success messages, `'info'` for neutral info.
- This applies to: validation errors (“Please select a host”), save/delete failures, “State reset successfully”, 2FA errors, connection errors, etc.

---

## Anti-Patterns

- **DON’T** use `confirm('...')` for delete/clear/reset/destructive actions — use `HuntarrConfirm.show()` (modal).
- **DON’T** use `prompt('...')` for add/rename/name inputs — use a custom modal with an input field.
- **DON’T** use `alert('...')` alone for success/error/info — use `showNotification(msg, type)` with `alert()` fallback (toast).

---

## Files to Know

- **Global confirm modal:** `frontend/static/js/modules/core/confirm-modal.js`, `frontend/templates/components/confirm_modal.html`, `frontend/static/css/confirm-modal.css`
- **Section modals (add/rename/delete):** e.g. Instance Management in `movie_hunt_instance_management_section.html` + `movie-hunt-instance-management.js`
- **Toasts:** `window.huntarrUI.showNotification(message, 'error'|'success'|'info')` (do not modify the toast component for this rule; use it instead of alert)

---

## Detecting Violations (Before Commits or New Features)

Run these from the project root to find remaining native dialogs:

```bash
# Confirm: should only appear in fallbacks (else branch after HuntarrConfirm check) or unsaved-changes/session flows
grep -rn "confirm(" frontend/ --include="*.js" --include="*.html" | grep -v "HuntarrConfirm" | grep -v "// fallback" | grep -v "unsaved changes" | grep -v "session expired"

# Prompt: should be zero (all replaced with modals)
grep -rn "prompt(" frontend/ --include="*.js"

# Alert: should only appear in "else alert(...)" fallback after showNotification check
grep -rn "alert(" frontend/ --include="*.js"
```

**What to replace:**
- Any **new** `confirm(...)` for user choices → `HuntarrConfirm.show()` or a custom modal.
- Any **new** `prompt(...)` for user input → custom modal with input.
- Any **new** `alert(...)` used alone → `showNotification(..., 'error'|'success'|'info')` with `else alert(...)` fallback.

**Exception:** Unsaved-changes and session-expired confirmations may stay as `confirm()` until product decides to give them custom modals; leave them out of the “must replace” list when scanning.
